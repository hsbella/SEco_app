import streamlit as st
import pandas as pd
import pickle

st.title("ðŸ”® ê³µì—° ìœ„í—˜ë„ ì˜ˆì¸¡")

# ----------------------------------
# 1. ëª¨ë¸ ë¶ˆëŸ¬ì˜¤ê¸°
# ----------------------------------
with open("model.pkl", "rb") as f:
    model = pickle.load(f)

# ----------------------------------
# 2. ìž…ë ¥ UI
# ----------------------------------

# í•™ìŠµ ë°ì´í„°ì—ì„œ ì‚¬ìš©ëœ ì‹¤ì œ ì¹´í…Œê³ ë¦¬ ê°’ê³¼ ì¼ì¹˜ì‹œí‚¤ê¸°
hall_list = ['KSPO DOME', 'í•¸ë“œë³¼ê²½ê¸°ìž¥', 'ì˜¬ë¦¼í”½í™€', 'ìš°ë¦¬ê¸ˆìœµì•„íŠ¸í™€']
genre_list = [
    'ì•„ì´ëŒ/ëŒ„ìŠ¤/ëŒ€ì¤‘ê°€ìš”',
    'ê°ˆë¼',
    'ë®¤ì§€ì»¬/í´ëž˜ì‹/ì˜¤ì¼€ìŠ¤íŠ¸ë¼',
    'íŒ/ë°´ë“œ/ìž¬ì¦ˆ',
    'íŠ¸ë¡œíŠ¸',
    'ì´ë²¤íŠ¸/ê¸°íƒ€',
    'ë°œë¼ë“œ',
    'ì „ìžìŒì•…/íž™í•©',
    'ì¸ë””/ì–´ì¿ ìŠ¤í‹±'
]

hall = st.selectbox("ê³µì—°ìž¥", hall_list)
genre = st.selectbox("ìž¥ë¥´", genre_list)
audience = st.slider("ê´€ëžŒì¸ì›", 100, 100000, 100, step=100)
month = st.selectbox("ì›”", list(range(1, 13)))

# ----------------------------------
# 3. ì˜ˆì¸¡
# ----------------------------------

if st.button("ì˜ˆì¸¡í•˜ê¸°"):
    # ìž…ë ¥ê°’ ë¬¸ìžì—´ ì •ì œ (ê³µë°± ì œê±°)
    hall_clean = hall.strip()
    genre_clean = genre.strip()

    # new_dataë¥¼ í•™ìŠµê³¼ ë™ì¼í•œ ì»¬ëŸ¼ ìˆœì„œë¡œ
    new_data = pd.DataFrame([{
        'ê³µì—°ìž¥': hall_clean,
        'ìž¥ë¥´': genre_clean,
        'ê´€ëžŒì¸ì›': audience,
        'MONTH': month
    }], columns=['ê³µì—°ìž¥', 'ìž¥ë¥´', 'ê´€ëžŒì¸ì›', 'MONTH'])

    pred = model.predict(new_data)[0]

    # ìœ„í—˜ ë“±ê¸‰
    if pred >= 81: label = "ðŸš¨ 5ë‹¨ê³„ (ìœ„í—˜)"
    elif pred >= 61: label = "âš ï¸ 4ë‹¨ê³„ (ê²½ê³„)"
    elif pred >= 41: label = "3ë‹¨ê³„ (ì£¼ì˜)"
    elif pred >= 21: label = "2ë‹¨ê³„ (ì–‘í˜¸)"
    else: label = "1ë‹¨ê³„ (ì•ˆì „)"

    st.subheader("ðŸ“Œ ì˜ˆì¸¡ ê²°ê³¼")
    st.write(f"**AV-HSI ì˜ˆì¸¡ì¹˜:** {pred:.2f}")
    st.write(f"**ìœ„í—˜ ë“±ê¸‰:** {label}")
